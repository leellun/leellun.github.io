<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>如何用hexo在github上搭建自己的博客</title>
    <link href="/2022/09/23/%E5%A6%82%E4%BD%95%E7%94%A8hexo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/"/>
    <url>/2022/09/23/%E5%A6%82%E4%BD%95%E7%94%A8hexo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/</url>
    
    <content type="html"><![CDATA[<h1 id="一、github仓库创建"><a href="#一、github仓库创建" class="headerlink" title="一、github仓库创建"></a>一、github仓库创建</h1><p>在github创建仓库，仓库名称为[username].github.io。</p><img src="/2022/09/23/%E5%A6%82%E4%BD%95%E7%94%A8hexo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/image-20220923174506204.png" class="" title="image-20220923174506204"><p>然后选择设置</p><img src="/2022/09/23/%E5%A6%82%E4%BD%95%E7%94%A8hexo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/image-20220923175440656.png" class="" title="image-20220923175440656"><p>设置网站的访问host并且制定分支为主分支</p><img src="/2022/09/23/%E5%A6%82%E4%BD%95%E7%94%A8hexo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/image-20220923175557661.png" class="" title="image-20220923175557661"><p>配置git免登录认证信息</p><img src="/2022/09/23/%E5%A6%82%E4%BD%95%E7%94%A8hexo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2/image-20220923180413762.png" class="" title="image-20220923180413762"><h1 id="二、hexo使用"><a href="#二、hexo使用" class="headerlink" title="二、hexo使用"></a>二、hexo使用</h1><h2 id="1-1-安装hexo"><a href="#1-1-安装hexo" class="headerlink" title="1.1 安装hexo"></a>1.1 安装hexo</h2><p>全局安装hexo</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmake">npm <span class="hljs-keyword">install</span> -g hexo<br><span class="hljs-comment"># 发布支持</span><br>npm <span class="hljs-keyword">install</span> --save hexo-deployer-git<br><br></code></pre></td></tr></table></figure><h2 id="1-2-创建hexo项目并且推到github上"><a href="#1-2-创建hexo项目并且推到github上" class="headerlink" title="1.2 创建hexo项目并且推到github上"></a>1.2 创建hexo项目并且推到github上</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-comment"># 创建文件夹 [username].github.io</span><br>mkdir [username]<span class="hljs-string">.github.io</span><br><span class="hljs-comment"># 执行hexo初始化操作</span><br>hexo init<br><span class="hljs-comment"># 将 github [username].github.io的.git的文件夹放入项目中，指定分支developer或其它分支作为hexo项目源码存放分支</span><br><br><span class="hljs-comment"># 构建静态页面</span><br>hexo generate<br><br><span class="hljs-comment"># 发布 到master</span><br>hexo <span class="hljs-keyword">deploy</span><br></code></pre></td></tr></table></figure><h2 id="1-3-hexo-配置修改"><a href="#1-3-hexo-配置修改" class="headerlink" title="1.3 hexo 配置修改"></a>1.3 hexo 配置修改</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">title:</span> <span class="hljs-string">青叶水间</span> <span class="hljs-bullet">-</span> <span class="hljs-string">一个IT技术文章分享博客</span><br><span class="hljs-attr">subtitle:</span> <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-attr">description:</span> <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-attr">keywords:</span><br><span class="hljs-attr">author:</span> <span class="hljs-string">leellun</span><br><span class="hljs-attr">language:</span> <span class="hljs-string">zh-CN</span><br><span class="hljs-attr">timezone:</span> <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span><br><span class="hljs-comment">## 主题配置，我这里用的fluid主题</span><br><span class="hljs-attr">theme:</span> <span class="hljs-string">fluid</span>  <br><br><span class="hljs-comment"># 发布信息 git，地址是repo配置，分支branch ，需要发布必须配置了git的ssh-gen</span><br><span class="hljs-comment"># 这里还需要安装了 插件hexo-deployer-git，npm install --save hexo-deployer-git</span><br><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">git@github.com:leellun/leellun.github.io.git</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">master</span><br></code></pre></td></tr></table></figure><h2 id="1-4-markdown图片支持"><a href="#1-4-markdown图片支持" class="headerlink" title="1.4 markdown图片支持"></a>1.4 markdown图片支持</h2><p>修改_config.yml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">post_asset_folder:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>安装依赖支持：</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima">npm install hexo-<span class="hljs-built_in">image</span>-link --<span class="hljs-built_in">save</span><br></code></pre></td></tr></table></figure><h2 id="1-5-主题添加"><a href="#1-5-主题添加" class="headerlink" title="1.5 主题添加"></a>1.5 主题添加</h2><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">npm install hexo-theme-fluid <span class="hljs-comment">--save</span><br></code></pre></td></tr></table></figure><p>主题配置：_config.fluid.yml</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">favicon:</span> <span class="hljs-keyword">/img/</span>leaf_icon.png<br><span class="hljs-symbol"></span><br><span class="hljs-symbol">navbar:</span><br>  <span class="hljs-meta"># 导航栏左侧的标题，为空则按 hexo config 中 `title` 显示</span><br>  <span class="hljs-meta"># The title on the left side of the navigation bar. If empty, it is based on `title` in hexo config</span><br><span class="hljs-symbol">  blog_title:</span> <span class="hljs-string">&quot;青叶水间&quot;</span><br><span class="hljs-symbol">index:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">  slogan:</span><br><span class="hljs-symbol">    enable:</span> true<br><br>    <span class="hljs-meta"># 为空则按 hexo config.subtitle 显示</span><br>    <span class="hljs-meta"># If empty, text based on `subtitle` in hexo config</span><br><span class="hljs-symbol">    text:</span> <span class="hljs-string">&quot;一个Java、SpringBoot、SpringCloud、服务器等文章分享博客网站&quot;</span><br><span class="hljs-symbol">post:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">archive:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">category:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">tag:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">about:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">page:</span><br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">page404:</span><br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><span class="hljs-symbol">  banner_img_height:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">links:</span><br><span class="hljs-symbol">  enable:</span> true<br><span class="hljs-symbol">  banner_img:</span> <span class="hljs-keyword">/img/</span>bg-default.png<br><br><span class="hljs-meta">#---------------------------</span><br><span class="hljs-meta"># 页脚</span><br><span class="hljs-meta"># Footer</span><br><span class="hljs-meta">#---------------------------</span><br><span class="hljs-symbol">footer:</span><br>  <span class="hljs-meta"># 页脚第一行文字的 HTML，建议保留 Fluid 的链接，用于向更多人推广本主题</span><br>  <span class="hljs-meta"># HTML of the first line of the footer, it is recommended to keep the Fluid link to promote this theme to more people</span><br><span class="hljs-symbol">  content:</span> &#x27;<br>    <span class="hljs-params">&lt;a href=&quot;https://hexo.io&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;</span><span class="hljs-params">&lt;span&gt;</span>Hexo<span class="hljs-params">&lt;/span&gt;</span><span class="hljs-params">&lt;/a&gt;</span><br>    <span class="hljs-params">&lt;i class=&quot;iconfont icon-love&quot;&gt;</span><span class="hljs-params">&lt;/i&gt;</span><br>    <span class="hljs-params">&lt;a href=&quot;https://github.com/leellun&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;</span><span class="hljs-params">&lt;span&gt;</span>我的github<span class="hljs-params">&lt;/span&gt;</span><span class="hljs-params">&lt;/a&gt;</span><br></code></pre></td></tr></table></figure><h1 id="三、页面与文章"><a href="#三、页面与文章" class="headerlink" title="三、页面与文章"></a>三、页面与文章</h1><p>创建页面：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-meta"># 创建about页面</span><br>hexo <span class="hljs-keyword">new</span> <span class="hljs-type">page</span> about<br></code></pre></td></tr></table></figure><p>创建文章：</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">hexo <span class="hljs-keyword">new</span> <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>文章头信息：</p><table><thead><tr><th>Data</th><th>Description</th></tr></thead><tbody><tr><td><code>title</code></td><td>标题</td></tr><tr><td><code>slug</code></td><td>地址</td></tr><tr><td><code>layout</code></td><td>布局</td></tr><tr><td><code>path</code></td><td>路径。Hexo默认情况下基于new_post_path设置构建post路径。</td></tr><tr><td><code>date</code></td><td>日期 默认当前</td></tr><tr><td>tags</td><td>标签</td></tr><tr><td>categories</td><td>类别</td></tr><tr><td>author</td><td>作者</td></tr></tbody></table><p>更多：<a href="https://hexo.io/docs/variables.html">https://hexo.io/docs/variables.html</a></p><p>启动服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>构建静态文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>推送到github，提供网页浏览：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>这里是我的博客网站源码配置（deveploer分支）：<a href="https://github.com/leellun/leellun.github.io">https://github.com/leellun/leellun.github.io</a></p>]]></content>
    
    
    <categories>
      
      <category>前端</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
      <tag>github</tag>
      
      <tag>博客</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>如何用hexo在github上搭建自己的博客</title>
    <link href="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/"/>
    <url>/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/</url>
    
    <content type="html"><![CDATA[<h1 id="一、KubeSphere-介绍"><a href="#一、KubeSphere-介绍" class="headerlink" title="一、KubeSphere 介绍"></a>一、KubeSphere 介绍</h1><p>KubeSphere 是在 Kubernetes 之上构建的面向云原生应用的<strong>分布式操作系统</strong>，完全开源，支持多云与多集群管理，提供全栈的 IT 自动化运维能力，简化企业的 DevOps 工作流。它的架构可以非常方便地使第三方应用与云原生生态组件进行即插即用 (plug-and-play) 的集成。 </p><p>功能：</p><ul><li>多云与多集群管理</li><li>Kubernetes 资源管理</li><li>DevOps</li><li>应用生命周期管理</li><li>微服务治理（服务网格）</li><li>日志查询与收集</li><li>服务与网络</li><li>多租户管理</li><li>监控告警</li><li>事件与审计查询</li><li>存储管理</li><li>访问权限控制</li><li>GPU 支持</li><li>网络策略</li><li>镜像仓库管理</li><li>安全管理等 </li></ul><h1 id="二、部署-KubeSphere"><a href="#二、部署-KubeSphere" class="headerlink" title="二、部署 KubeSphere"></a>二、部署 KubeSphere</h1><p>当卸载重新安装时，执行下面 的脚本全面卸载：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/kubesphere/</span>ks-installer<span class="hljs-regexp">/edit/m</span>aster<span class="hljs-regexp">/scripts/</span>kubesphere-<span class="hljs-keyword">delete</span>.sh<br></code></pre></td></tr></table></figure><h2 id="2-1-执行以下命令以开始安装："><a href="#2-1-执行以下命令以开始安装：" class="headerlink" title="2.1 执行以下命令以开始安装："></a>2.1 执行以下命令以开始安装：</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">kubectl apply -f https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/kubesphere/</span>ks-installer<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v3.2.1/</span>kubesphere-installer.yaml<br>kubectl apply -f https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/kubesphere/</span>ks-installer<span class="hljs-regexp">/releases/</span>download<span class="hljs-regexp">/v3.2.1/</span>cluster-configuration.yaml<br><br><span class="hljs-comment">#默认sc</span><br> kubectl patch sc openebs-hostpath -p <span class="hljs-string">&#x27;&#123;&quot;metadata&quot;: &#123;&quot;annotations&quot;: &#123;&quot;storageclass.beta.kubernetes.io/is-default-class&quot;: &quot;true&quot;&#125;&#125;&#125;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="2-2-检查安装"><a href="#2-2-检查安装" class="headerlink" title="2.2 检查安装"></a>2.2 检查安装</h2><p>日志查看：</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs clean">kubectl logs -n kubesphere-<span class="hljs-keyword">system</span> $(kubectl get pod -n kubesphere-<span class="hljs-keyword">system</span> -l <span class="hljs-string">&#x27;app in (ks-install, ks-installer)&#x27;</span> -o jsonpath=<span class="hljs-string">&#x27;&#123;.items[0].metadata.name&#125;&#x27;</span>) -f<br><br>结果：<br>Collecting installation results ...<br>#####################################################<br>###              Welcome to KubeSphere!           ###<br>#####################################################<br><br>Console: http:<span class="hljs-comment">//192.168.66.10:30880</span><br>Account: admin<br>Password: P@<span class="hljs-number">88</span>w0rd<br></code></pre></td></tr></table></figure><p>安装服务查看：</p><p>使用 <code>kubectl get pod --all-namespaces</code> 查看所有 Pod 在 KubeSphere 相关的命名空间是否正常运行。如果是正常运行，请通过以下命令来检查控制台的端口（默认为 30880，可以通过默认帐户和密码 (<code>admin/P@88w0rd</code>) 访问 Web 控制台。）：</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">kubectl <span class="hljs-built_in">get</span> svc/ks-console -n kubesphere-<span class="hljs-keyword">system</span><br></code></pre></td></tr></table></figure><p>重置密码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">kubectl patch <span class="hljs-built_in">users</span> &lt;USERNAME&gt; -p <span class="hljs-string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;password&quot;:&quot;&lt;YOURPASSWORD&gt;&quot;&#125;&#125;&#x27;</span> --<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;merge&#x27;</span> &amp;&amp; kubectl annotate <span class="hljs-built_in">users</span> &lt;USERNAME&gt; iam.kubesphere.io/password-encrypted-<br><br>kubectl patch <span class="hljs-built_in">users</span> admin -p <span class="hljs-string">&#x27;&#123;&quot;spec&quot;:&#123;&quot;password&quot;:&quot;P@88w0rd&quot;&#125;&#125;&#x27;</span> --<span class="hljs-built_in">type</span>=<span class="hljs-string">&#x27;merge&#x27;</span> &amp;&amp; kubectl annotate <span class="hljs-built_in">users</span> admin iam.kubesphere.io/password-encrypted-<br></code></pre></td></tr></table></figure><h1 id="三、示例wordpress部署"><a href="#三、示例wordpress部署" class="headerlink" title="三、示例wordpress部署"></a>三、示例wordpress部署</h1><p>这里使用project-regular权限账号进行登录，可以通过admin用户添加指定账号，然后创建空间demo-wordspace，并且创建demo-project项目</p><h2 id="3-1-密钥创建"><a href="#3-1-密钥创建" class="headerlink" title="3.1 密钥创建"></a>3.1 密钥创建</h2><p>选择<strong>类型</strong>为 Opaque（默认）</p><p>mysql密钥：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">名称：mysql-secret<br>键值：<span class="hljs-attribute">MYSQL_ROOT_PASSWORD</span>=123456<br></code></pre></td></tr></table></figure><p>创建 WordPress 密钥：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">名称：wordpress-secret<br>键值：WORDPRESS_DB_PASSWORD <span class="hljs-operator">=</span><span class="hljs-number">123456</span><br>   <br></code></pre></td></tr></table></figure><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662953701465.png" class="" width="1662953701465"><h2 id="3-2-创建持久卷声明"><a href="#3-2-创建持久卷声明" class="headerlink" title="3.2 创建持久卷声明"></a>3.2 创建持久卷声明</h2><p>创建持久券：wordpress-pvc ，选择（存储类、访问模式、卷容量）</p><h2 id="3-3-创建应用程序"><a href="#3-3-创建应用程序" class="headerlink" title="3.3 创建应用程序"></a>3.3 创建应用程序</h2><h3 id="3-3-1-添加-MySQL-后端组件"><a href="#3-3-1-添加-MySQL-后端组件" class="headerlink" title="3.3.1 添加 MySQL 后端组件"></a>3.3.1 添加 MySQL 后端组件</h3><p>（1）创建应用</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662954670517.png" class="" width="1662954670517"><p>（2）创建mysql服务</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662954686176.png" class="" width="1662954686176"><p>（3）选择有状态服务</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662954729101.png" class="" width="1662954729101"><p>（4）容器配置</p><p>在搜索框中输入 <code>mysql:5.6</code>，按下<strong>回车键</strong>，然后点击<strong>使用默认端口</strong>。</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662954919071.png" class="" width="1662954919071"><p>（5）环境变量配置</p><p>向下滚动到<strong>环境变量</strong>，点击<strong>来自保密字典</strong>。输入名称 <code>MYSQL_ROOT_PASSWORD</code>，然后选择资源 <code>mysql-secret</code> 和前面步骤中创建的密钥 <code>MYSQL_ROOT_PASSWORD</code></p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662955108731.png" class="" width="1662955108731"><p>（6）存储设置</p><p>选择<strong>存储设置</strong>中的<strong>添加持久卷声明模板</strong>，输入 PVC 名称前缀 (<code>mysql</code>) 和<strong>挂载路径</strong>（模式：<code>读写</code>，路径：/var/lib/mysql）的值。</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662955217850.png" class="" width="1662955217850"><p>（7）随后直接添加</p><h3 id="3-3-2-wordpress服务添加"><a href="#3-3-2-wordpress服务添加" class="headerlink" title="3.3.2 wordpress服务添加"></a>3.3.2 wordpress服务添加</h3><p>（1）无状态服务添加</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662955316163.png" class="" width="1662955316163"><p>（2）容器配置</p><p>在搜索栏中输入 wordpress:4.8-apache 并按下<strong>回车键</strong>，然后点击<strong>使用默认端口</strong>。</p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662955481272.png" class="" width="1662955481272"><p>(3) 环境变量</p><p>向下滚动到<strong>环境变量</strong>，点击<strong>来自保密字典</strong>。这里需要添加两个环境变量，请输入以下值：</p><ul><li>对于 <code>WORDPRESS_DB_PASSWORD</code>，请选择在步骤 1 中创建的 <code>wordpress-secret</code> 和 <code>WORDPRESS_DB_PASSWORD</code>。</li><li>点击<strong>添加环境变量</strong>，分别输入 <code>WORDPRESS_DB_HOST</code> 和 <code>mysql</code> 作为键 (Key) 和值 (Value)。</li></ul><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662955721051.png" class="" width="1662955721051"><p>(4) 存储设置</p><p>选择上一步创建的 <code>wordpress-pvc</code>，将模式设置为<code>读写</code>，并输入挂载路径 <code>/var/www/html</code></p><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662956356797.png" class="" width="1662956356797"><p>（5）路由设置</p><p><strong>路由设置</strong>中设置路由规则（应用路由 Ingress），也可以直接点击<strong>创建</strong>。创建成功后，应用将显示在应用列表中。</p><h3 id="3-3-3-验证资源"><a href="#3-3-3-验证资源" class="headerlink" title="3.3.3 验证资源"></a>3.3.3 验证资源</h3><p>在<strong>工作负载</strong>中，分别检查<strong>部署</strong>和<strong>有状态副本集</strong>中 <code>wordpress-v1</code> 和 <code>mysql-v1</code> 的状态。如果它们的运行状态为<strong>运行中</strong>，就意味着 WordPress 已经成功创建。</p><h3 id="3-3-4-通过-NodePort-访问-WordPress"><a href="#3-3-4-通过-NodePort-访问-WordPress" class="headerlink" title="3.3.4 通过 NodePort 访问 WordPress"></a>3.3.4 通过 NodePort 访问 WordPress</h3><ol><li>若要在集群外访问服务，选择左侧导航栏中的<strong>应用负载 &gt; 服务</strong>。点击 <code>wordpress</code> 右侧的三个点后，选择<strong>编辑外部访问</strong>。</li><li>在<strong>访问方式</strong>中选择 <code>NodePort</code>，然后点击<strong>确定</strong>。</li><li>点击<strong>服务</strong>进入详情页，可以在<strong>端口</strong>处查看暴露的端口。</li><li>通过 <code>&#123;Node IP&#125;:&#123;NodePort&#125;</code> 访问此应用程序，可以看到下图：</li></ol><h1 id="四、查看结果"><a href="#四、查看结果" class="headerlink" title="四、查看结果"></a>四、查看结果</h1><img src="/2022/07/24/k8s%E5%BF%AB%E9%80%9F%E9%9B%86%E6%88%90KubeSphere/1662979858086.png" class="" width="1662979858086">]]></content>
    
    
    <categories>
      
      <category>服务器</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
      <tag>kubernetes </tag>
      
      <tag>kubesphere</tag>
      
      <tag>wordpress</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>k8s持久化存储之OpenEBS</title>
    <link href="/2022/07/23/k8s%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E4%B9%8BOpenEBS/"/>
    <url>/2022/07/23/k8s%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8%E4%B9%8BOpenEBS/</url>
    
    <content type="html"><![CDATA[<h1 id="一、介绍"><a href="#一、介绍" class="headerlink" title="一、介绍"></a>一、介绍</h1><p>OpenEBS 是 CNCF 项目的一部分，采用 Apache v2 许可证。是 Kubernetes 部署使用最广泛且易用的开源存储解决方案。</p><p><strong>目的：</strong></p><p>让持久化工作负载的存储和存储服务完全集成到环境中，这样每个团队和工作负载都可以从控制的粒度和 Kubernetes 原生行为中获益。</p><p><strong>特点：</strong></p><ul><li><p>微服务架构，使用 Kubernetes 自身的能力来编排管理 OpenEBS 组件。</p></li><li><p>OpenEBS 支持一系列存储引擎，以便开发人员能够部署适合其应用程序设计目标的存储技术。</p><p>像 Cassandra 这样的分布式应用程序可以使用 LocalPV 引擎实现最低延迟的写操作。</p><p>像 MySQL 和 PostgreSQL 这样的独立应用程序可以使用 ZFS 引擎 (cStor) 进行恢复。</p><p>像 Kafka 这样的流媒体应用程序可以使用 NVMe 引擎 Mayastor 在边缘环境中获得最佳性能。</p><p>在各种引擎类型中，OpenEBS 为高可用性、快照、克隆和易管理性提供了一致的框架。</p></li><li><p>管理员和开发人员可以使用 Kubernetes 提供的所有工具来交互和管理 OpenEBS。</p></li></ul><h1 id="二、OpenEBS-存储引擎建议"><a href="#二、OpenEBS-存储引擎建议" class="headerlink" title="二、OpenEBS 存储引擎建议"></a>二、OpenEBS 存储引擎建议</h1><table><thead><tr><th>应用需求</th><th>存储类型</th><th>OpenEBS 卷类型</th></tr></thead><tbody><tr><td>低时延、高可用性、同步复制、快照、克隆、精简配置</td><td>SSD/ 云存储卷</td><td>OpenEBS Mayastor</td></tr><tr><td>高可用性、同步复制、快照、克隆、精简配置</td><td>机械 /SSD/ 云存储卷</td><td>OpenEBS cStor</td></tr><tr><td>高可用性、同步复制、精简配置</td><td>主机路径或外部挂载存储</td><td>OpenEBS Jiva</td></tr><tr><td>低时延、本地 PV</td><td>主机路径或外部挂载存储</td><td>Dynamic Local PV - Hostpath, Dynamic Local PV - Rawfile</td></tr><tr><td>低时延、本地 PV</td><td>本地机械 /SSD/ 云存储卷等块设备</td><td>Dynamic Local PV - Device</td></tr><tr><td>低延迟，本地 PV，快照，克隆</td><td>本地机械 /SSD/ 云存储卷等块设备</td><td>OpenEBS Dynamic Local PV - ZFS , OpenEBS Dynamic Local PV - LVM</td></tr></tbody></table><ul><li>多机环境，如果有额外的块设备（非系统盘块设备）作为数据盘，选用 <code>OpenEBS Mayastor</code>、<code>OpenEBS cStor</code></li><li>多机环境，如果没有额外的块设备（非系统盘块设备）作为数据盘，仅单块系统盘块设备，选用 <code>OpenEBS Jiva</code></li><li>单机环境，建议本地路径 <code>Dynamic Local PV - Hostpath, Dynamic Local PV - Rawfile</code>，由于单机多用于测试环境，数据可靠性要求较低。</li></ul><h1 id="三、安装"><a href="#三、安装" class="headerlink" title="三、安装"></a>三、安装</h1><p><a href="https://openebs.io/docs/2.12.x/user-guides/cstor">openobs官方安装文档</a></p><p>在安装openebs之前先去除污点，然后等安装完成再添加回来污点</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh"><span class="hljs-comment"># 去除污点</span><br>kubectl taint nodes k8s-master01 <span class="hljs-keyword">node</span><span class="hljs-title">-role</span>.kubernetes.io/<span class="hljs-attr">master=</span>:NoSchedule-<br><span class="hljs-comment"># 添加污点</span><br>kubectl taint nodes k8s-master01 <span class="hljs-keyword">node</span><span class="hljs-title">-role</span>.kubernetes.io/<span class="hljs-attr">master=</span>:NoSchedule<br></code></pre></td></tr></table></figure><p>添加helm repo</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">helm</span> repo <span class="hljs-keyword">add</span> openebs https:<span class="hljs-comment">//openebs.github.io/charts</span><br><span class="hljs-symbol">helm</span> repo update<br></code></pre></td></tr></table></figure><p>安装openebs（这里只会安装Jiva和Local组件）</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">helm install openebs</span> <span class="hljs-literal">--</span><span class="hljs-comment">namespace openebs openebs/openebs</span> <span class="hljs-literal">--</span><span class="hljs-comment">create</span><span class="hljs-literal">-</span><span class="hljs-comment">namespace</span> <span class="hljs-literal">--</span><span class="hljs-comment">version 3</span><span class="hljs-string">.</span><span class="hljs-comment">0</span><span class="hljs-string">.</span><span class="hljs-comment">x</span><br></code></pre></td></tr></table></figure><p>添加cstor支持</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">helm install openebs <span class="hljs-params">--namespace</span> openebs openebs/openebs <span class="hljs-params">--create-namespace</span> <span class="hljs-params">--set</span> cstor.enabled=<span class="hljs-literal">true</span> <span class="hljs-params">--version</span> 3.2.0<br></code></pre></td></tr></table></figure><p>查看安装</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 查看安装pod</span><br>kubectl <span class="hljs-built_in">get</span> pod -n openebs<br><span class="hljs-comment"># 查看安装blockdevice，这里的blockdevice是磁盘，当添加一块未分配的磁盘，就会有值</span><br>kubectl <span class="hljs-built_in">get</span> bd -n openebs<br></code></pre></td></tr></table></figure><p>OpenEBS依赖与iSCSI做存储管理，因此需要先确保您的集群上已有安装openiscsi。 （这里当报错的时候可以安装试试）</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">yum -y install iscsi-initiator-utils<br>systemctl <span class="hljs-keyword">enable</span> iscsid <span class="hljs-comment">--now</span><br>systemctl <span class="hljs-keyword">start</span> iscsid<br></code></pre></td></tr></table></figure><p>查看安装状况：</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@k8s-master01 ~]<span class="hljs-comment"># kubectl get pod -n openebs</span><br>NAME                                            READY   STATUS    RESTARTS         AGE<br>openebs-cstor-admission-server-b74f5487-lkz84   1/1     Running  <span class="hljs-number"> 1 </span>(6m21s ago)    8h<br>openebs-cstor-csi-controller-0                  6/6     Running  <span class="hljs-number"> 0 </span>               4m44s<br>openebs-cstor-csi-node-4df4w                    2/2     Running  <span class="hljs-number"> 2 </span>(61m ago)      8h<br>openebs-cstor-csi-node-x8bmt                    2/2     Running  <span class="hljs-number"> 6 </span>(16m ago)      8h<br>openebs-cstor-csi-node-zzn4k                    2/2     Running  <span class="hljs-number"> 2 </span>(6m21s ago)    8h<br>openebs-cstor-cspc-operator-84464fb479-fh949    1/1     Running  <span class="hljs-number"> 3 </span>(16m ago)      8h<br>openebs-cstor-cvc-operator-646f6f676b-xhd44     1/1     Running  <span class="hljs-number"> 2 </span>(16m ago)      46m<br>openebs-localpv-provisioner-55b65f8b55-zqj29    1/1     Running  <span class="hljs-number"> 13 </span>(6m23s ago)   8h<br>openebs-ndm-429hl                               1/1     Running  <span class="hljs-number"> 2 </span>(4m28s ago)    8h<br>openebs-ndm-9kkzd                               1/1     Running  <span class="hljs-number"> 1 </span>(6m21s ago)    8h<br>openebs-ndm-operator-6c944d87b6-5ddxz           1/1     Running  <span class="hljs-number"> 2 </span>(16m ago)      46m<br>openebs-ndm-sqnwx                               1/1     Running  <span class="hljs-number"> 6 </span>(15m ago)      8h<br></code></pre></td></tr></table></figure><h1 id="四、添加磁盘"><a href="#四、添加磁盘" class="headerlink" title="四、添加磁盘"></a>四、添加磁盘</h1><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs llvm">[root<span class="hljs-title">@k8s-master01</span> ~]# kubectl get bd -n openebs<br>NAME                                           NODENAME       SIZE           CLAIMSTATE   STATUS     AGE<br>blockdevice<span class="hljs-number">-57886</span>fae<span class="hljs-number">032</span>a<span class="hljs-number">3</span>d<span class="hljs-number">3638</span>badeb<span class="hljs-number">1282</span>dd<span class="hljs-number">67</span>e   k<span class="hljs-number">8</span>s-node<span class="hljs-number">02</span>     <span class="hljs-number">21473771008</span>    Unclaimed    Active     <span class="hljs-number">53</span>s<br>blockdevice-d<span class="hljs-number">923</span>fc<span class="hljs-number">382</span>d<span class="hljs-number">96</span>ff<span class="hljs-number">6</span>eea<span class="hljs-number">7</span>d<span class="hljs-number">9</span>ab<span class="hljs-number">8</span>efb<span class="hljs-number">66224</span>   k<span class="hljs-number">8</span>s-master<span class="hljs-number">01</span>   <span class="hljs-number">21473771008</span>    Unclaimed    Active     <span class="hljs-number">11</span>m<br>blockdevice-e<span class="hljs-number">5009</span>ce<span class="hljs-number">419</span><span class="hljs-keyword">c</span><span class="hljs-number">80719025</span><span class="hljs-keyword">c</span><span class="hljs-number">4</span><span class="hljs-keyword">cc</span><span class="hljs-number">9409253</span>ab   k<span class="hljs-number">8</span>s-node<span class="hljs-number">01</span>     <span class="hljs-number">21473771008</span>    Unclaimed    Active     <span class="hljs-number">33</span>s<br></code></pre></td></tr></table></figure><h1 id="五、配置"><a href="#五、配置" class="headerlink" title="五、配置"></a>五、配置</h1><h2 id="5-1-创建cStor存储池"><a href="#5-1-创建cStor存储池" class="headerlink" title="5.1 创建cStor存储池"></a>5.1 创建cStor存储池</h2><p>cspc.yaml ：</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cstor.openebs.io/v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">CStorPoolCluster</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br> <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">cstor-disk-pool</span><br> <span class="hljs-attribute">namespace</span><span class="hljs-punctuation">:</span> <span class="hljs-string">openebs</span><br><span class="hljs-attribute">spec</span><span class="hljs-punctuation">:</span><br> <span class="hljs-attribute">pools</span><span class="hljs-punctuation">:</span><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">nodeSelector:</span><br>       <span class="hljs-attribute">kubernetes.io/hostname</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;k8s-master01&quot;</span><br>     <span class="hljs-attribute">dataRaidGroups</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">blockDevices:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">blockDeviceName: &quot;blockdevice-d923fc382d96ff6eea7d9ab8efb66224&quot;</span><br>     <span class="hljs-attribute">poolConfig</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-attribute">dataRaidGroupType</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stripe&quot;</span><br><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">nodeSelector:</span><br>       <span class="hljs-attribute">kubernetes.io/hostname</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;k8s-node01&quot;</span><br>     <span class="hljs-attribute">dataRaidGroups</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">blockDevices:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">blockDeviceName: &quot;blockdevice-e5009ce419c80719025c4cc9409253ab&quot;</span><br>     <span class="hljs-attribute">poolConfig</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-attribute">dataRaidGroupType</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stripe&quot;</span><br><br>   <span class="hljs-bullet">-</span> <span class="hljs-string">nodeSelector:</span><br>       <span class="hljs-attribute">kubernetes.io/hostname</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;k8s-node02&quot;</span><br>     <span class="hljs-attribute">dataRaidGroups</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-bullet">-</span> <span class="hljs-string">blockDevices:</span><br>           <span class="hljs-bullet">-</span> <span class="hljs-string">blockDeviceName: &quot;blockdevice-57886fae032a3d3638badeb1282dd67e&quot;</span><br>     <span class="hljs-attribute">poolConfig</span><span class="hljs-punctuation">:</span><br>       <span class="hljs-attribute">dataRaidGroupType</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;stripe&quot;</span><br></code></pre></td></tr></table></figure><p>dataRaidGroupType:可以根据您的需要设置为 <code>stripe</code> or <code>mirror</code> 。下面以配置为stripe为例。 </p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs tap">[root@k8s-master01 openebs]<span class="hljs-comment"># kubectl get CStorPoolCluster -n openebs</span><br>NAME              HEALTHYINSTANCES   PROVISIONEDINSTANCES   DESIREDINSTANCES   AGE<br>cstor-disk-pool                     <span class="hljs-number"> 3 </span>                    <span class="hljs-number"> 3 </span>                 42s<br></code></pre></td></tr></table></figure><h2 id="5-2-storageclass创建"><a href="#5-2-storageclass创建" class="headerlink" title="5.2 storageclass创建"></a>5.2 storageclass创建</h2><h3 id="5-2-1-cstor的创建"><a href="#5-2-1-cstor的创建" class="headerlink" title="5.2.1 cstor的创建"></a>5.2.1 cstor的创建</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">kind:</span> <span class="hljs-string">StorageClass</span><br><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">storage.k8s.io/v1</span><br><span class="hljs-attr">metadata:</span><br>  <span class="hljs-attr">name:</span> <span class="hljs-string">cstor-csi-disk</span><br><span class="hljs-attr">provisioner:</span> <span class="hljs-string">cstor.csi.openebs.io</span><br><span class="hljs-attr">allowVolumeExpansion:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">parameters:</span><br>  <span class="hljs-attr">cas-type:</span> <span class="hljs-string">cstor</span><br>  <span class="hljs-comment"># cstorPoolCluster should have the name of the CSPC</span><br>  <span class="hljs-attr">cstorPoolCluster:</span> <span class="hljs-string">cstor-disk-pool</span><br>  <span class="hljs-comment"># replicaCount should be &lt;= no. of CSPI created in the selected CSPC</span><br>  <span class="hljs-attr">replicaCount:</span> <span class="hljs-string">&quot;3&quot;</span><br></code></pre></td></tr></table></figure><p>添加硬盘后查看磁盘情况</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tap">磁盘 /dev/sdb：21.5 GB,<span class="hljs-number"> 21474836480 </span>字节，41943040 个扇区<br>Units = 扇区 of<span class="hljs-number"> 1 </span>*<span class="hljs-number"> 512 </span>=<span class="hljs-number"> 512 </span>bytes<br>扇区大小(逻辑/物理)：512 字节 /<span class="hljs-number"> 512 </span>字节<br>I/O 大小(最小/最佳)：512 字节 /<span class="hljs-number"> 512 </span>字节<br>磁盘标签类型：gpt<br>Disk identifier: ADA9C10B-8C31-4EE2-A29B-F2701E9554DC<br><br><br><span class="hljs-comment">#         Start          End    Size  Type            Name</span><br><span class="hljs-number"> 1 </span>       <span class="hljs-number"> 2048 </span>   <span class="hljs-number"> 41943006 </span>    20G  Linux filesyste OpenEBS_NDM<br></code></pre></td></tr></table></figure><h3 id="5-2-2-jiva"><a href="#5-2-2-jiva" class="headerlink" title="5.2.2 jiva"></a>5.2.2 jiva</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">storage.k8s.io/v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">StorageClass</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">jiva-storageclass</span><br>  <span class="hljs-attribute">annotations</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">openebs.io/cas-type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">jiva</span><br>    <span class="hljs-attribute">cas.openebs.io/config</span><span class="hljs-punctuation">:</span> <span class="hljs-string">|</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">name: StoragePool</span><br>        <span class="hljs-attribute">value</span><span class="hljs-punctuation">:</span> <span class="hljs-string">default</span><br><span class="hljs-attribute">provisioner</span><span class="hljs-punctuation">:</span> <span class="hljs-string">openebs.io/provisioner-iscsi</span><br></code></pre></td></tr></table></figure><h3 id="5-2-3-hostpath"><a href="#5-2-3-hostpath" class="headerlink" title="5.2.3  hostpath"></a>5.2.3  hostpath</h3><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">storage.k8s.io/v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">StorageClass</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">localpv-hostpath-sc</span><br>  <span class="hljs-attribute">annotations</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">openebs.io/cas-type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">local</span><br>    <span class="hljs-attribute">cas.openebs.io/config</span><span class="hljs-punctuation">:</span> <span class="hljs-string">|</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">name: BasePath</span><br>        <span class="hljs-attribute">value</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/var/openebs/local&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">name: StorageType</span><br>        <span class="hljs-attribute">value</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hostpath&quot;</span><br><span class="hljs-attribute">provisioner</span><span class="hljs-punctuation">:</span> <span class="hljs-string">openebs.io/local</span><br></code></pre></td></tr></table></figure><h3 id="5-2-4-device"><a href="#5-2-4-device" class="headerlink" title="5.2.4 device"></a>5.2.4 device</h3><p>下面的类型需要添加硬盘</p><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs tap">磁盘 /dev/sdc：21.5 GB,<span class="hljs-number"> 21474836480 </span>字节，41943040 个扇区<br>Units = 扇区 of<span class="hljs-number"> 1 </span>*<span class="hljs-number"> 512 </span>=<span class="hljs-number"> 512 </span>bytes<br>扇区大小(逻辑/物理)：512 字节 /<span class="hljs-number"> 512 </span>字节<br>I/O 大小(最小/最佳)：512 字节 /<span class="hljs-number"> 512 </span>字节<br>磁盘标签类型：gpt<br>Disk identifier: BAD0A706-0A9D-478A-85C6-319224EC5D1F<br><br><br><span class="hljs-comment">#         Start          End    Size  Type            Name</span><br><span class="hljs-number"> 1 </span>       <span class="hljs-number"> 2048 </span>   <span class="hljs-number"> 41943006 </span>    20G  Linux filesyste OpenEBS_NDM<br></code></pre></td></tr></table></figure><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">apiVersion</span><span class="hljs-punctuation">:</span> <span class="hljs-string">storage.k8s.io/v1</span><br><span class="hljs-attribute">kind</span><span class="hljs-punctuation">:</span> <span class="hljs-string">StorageClass</span><br><span class="hljs-attribute">metadata</span><span class="hljs-punctuation">:</span><br>  <span class="hljs-attribute">name</span><span class="hljs-punctuation">:</span> <span class="hljs-string">localpv-device-sc</span><br>  <span class="hljs-attribute">annotations</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">openebs.io/cas-type</span><span class="hljs-punctuation">:</span> <span class="hljs-string">local</span><br>    <span class="hljs-attribute">cas.openebs.io/config</span><span class="hljs-punctuation">:</span> <span class="hljs-string">|</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">name: StorageType</span><br>        <span class="hljs-attribute">value</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;device&quot;</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">name: FSType</span><br>        <span class="hljs-attribute">value</span><span class="hljs-punctuation">:</span> <span class="hljs-string">ext4</span><br><span class="hljs-attribute">provisioner</span><span class="hljs-punctuation">:</span> <span class="hljs-string">openebs.io/local</span><br></code></pre></td></tr></table></figure><p>查看：</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">[root@k8s-master01 openebs]# kubectl <span class="hljs-keyword">get</span> sc -n openebs<br><span class="hljs-type">NAME</span>               PROVISIONER            RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE<br>cstor-csi-disk     cstor.csi.openebs.io   <span class="hljs-keyword">Delete</span>          <span class="hljs-keyword">Immediate</span>              <span class="hljs-keyword">true</span>                   <span class="hljs-number">43</span>s<br>openebs-device     openebs.io/<span class="hljs-keyword">local</span>       <span class="hljs-keyword">Delete</span>          WaitForFirstConsumer   <span class="hljs-keyword">false</span>                  <span class="hljs-number">9</span>h<br>openebs-hostpath   openebs.io/<span class="hljs-keyword">local</span>       <span class="hljs-keyword">Delete</span>          WaitForFirstConsumer   <span class="hljs-keyword">false</span>                  <span class="hljs-number">9</span>h<br></code></pre></td></tr></table></figure><h3 id="5-2-5-cStor、Jiva、LocalPV-特性比较："><a href="#5-2-5-cStor、Jiva、LocalPV-特性比较：" class="headerlink" title="5.2.5 cStor、Jiva、LocalPV 特性比较："></a>5.2.5 cStor、Jiva、LocalPV 特性比较：</h3><table><thead><tr><th>特性</th><th>Jiva</th><th>cStor</th><th>Local PV</th></tr></thead><tbody><tr><td>轻量级运行于用户空间</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>同步复制</td><td>Yes</td><td>Yes</td><td>No</td></tr><tr><td>适合低容量工作负载</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>支持快照，克隆</td><td>Basic</td><td>Advanced</td><td>No</td></tr><tr><td>数据一致性</td><td>Yes</td><td>Yes</td><td>NA</td></tr><tr><td>使用 Velero 恢复备份</td><td>Yes</td><td>Yes</td><td>Yes</td></tr><tr><td>适合高容量工作负载</td><td>No</td><td>Yes</td><td>Yes</td></tr><tr><td>自动精简配置</td><td></td><td>Yes</td><td>No</td></tr><tr><td>磁盘池或聚合支持</td><td></td><td>Yes</td><td>No</td></tr><tr><td>动态扩容</td><td></td><td>Yes</td><td>Yes</td></tr><tr><td>数据弹性 (RAID 支持)</td><td></td><td>Yes</td><td>No</td></tr><tr><td>接近原生磁盘性能</td><td>No</td><td>No</td><td>Yes</td></tr></tbody></table><p>大多数场景推荐 <code>cStor</code>，因其提供了强大的功能，包括快照 / 克隆、存储池功能（如精简资源调配、按需扩容等）。</p><p><code>Jiva</code> 适用于低容量需求的工作负载场景，例如 <code>5</code> 到 <code>50G</code>。尽管使用 <code>Jiva</code> 没有空间限制，但建议将其用于低容量工作负载。<code>Jiva</code> 非常易于使用，并提供企业级容器本地存储，而不需要专用硬盘。有快照和克隆功能的需求的场景，优先考虑使用 <code>cStor</code> 而不是 <code>Jiva</code>。</p><h2 id="5-3-默认sc"><a href="#5-3-默认sc" class="headerlink" title="5.3 默认sc"></a>5.3 默认sc</h2><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kotlin">kubectl patch storage<span class="hljs-keyword">class</span> <span class="hljs-title class_">cstor</span>-<span class="hljs-title">csi</span>-<span class="hljs-title">disk</span> -<span class="hljs-title">p</span> &#x27;&#123;<span class="hljs-string">&quot;metadata&quot;</span>: &#123;<span class="hljs-string">&quot;annotations&quot;</span>:&#123;<span class="hljs-string">&quot;storageclass.kubernetes.io/is-default-class&quot;</span>:<span class="hljs-string">&quot;true&quot;</span>&#125;&#125;&#125;<span class="hljs-string">&#x27;</span><br></code></pre></td></tr></table></figure><p>推荐文章：</p><p><a href="https://blog.csdn.net/easylife206/article/details/125213855">https://blog.csdn.net/easylife206/article/details/125213855</a></p><p><a href="https://zhuanlan.zhihu.com/p/519172233">https://zhuanlan.zhihu.com/p/519172233</a></p>]]></content>
    
    
    <categories>
      
      <category>服务器</category>
      
    </categories>
    
    
    <tags>
      
      <tag>k8s</tag>
      
      <tag>openebs</tag>
      
      <tag>kubernetes</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
